N+1 문제는 하위 엔티티들이 존재하는 경우 한 쿼리에서 모두 가져오는 것이 아닌 필요한 곳에서 각각 쿼리가 발생하는 경우를 말합니다.

즉시로딩과 지연 로딩 상황에서 모두 발생할 수 있습니다.

즉시 로딩에서 발생하는 이유는 JPQL을 사용하는 경우 전체 조회를 했을 때, 영속성 컨텍스트가 아닌 데이터베이스에서 직접 데이터를 조회한 다음 즉시로딩 전략이 동작하기 때문입니다.

지연로딩에서 발생하는 이유는 지연 로딩 전략을 사용한 하위 엔티티를 로드할 때, JPA에서 프록시 엔티티를 unproxy할 때 해당 엔티티를 조회하기 위한 추가적인 쿼리가 실행되며 발생합니다.

해결 방법으로는 JPQL의 join fetch를 사용하는 방법, @EntityGraph를 사용하는 방법, Fetch(FetchMode.SUBSELECT)를 사용하는 방법, @BatchSize를 사용해 조절하거나 전역적인 batch-size를 설정하는 방법이 있습니다.